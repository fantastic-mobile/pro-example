
/**
 * 由 Fantastic-mobile 提供技术支持
 * Powered by Fantastic-mobile
 * https://fantastic-mobile.hurui.me/
 */
    
import{_ as F}from"./index-TGLGxjLi.js";import{_ as z}from"./index.vue_vue_type_script_setup_true_lang-CuFXODrP.js";import{d as L,S as B,o,c as g,ad as $,w as h,k as f,a7 as E,a8 as M,a as p,b as v,e as P,F as I,n as A,p as b,a1 as N,u as t,q as V,t as C,r as w,f as j,_ as D,X as S}from"./index-DSCegQmK.js";import"./index.vue_vue_type_script_setup_true_lang-Sn60HHzg.js";const R={key:0,class:"fixed inset-0 z-5000 size-full flex items-center justify-center backdrop-blur-2xl"},q={class:"relative h-96"},X={class:"relative mx-auto mt-40 max-w-xl flex flex-col justify-start"},Y={class:"flex flex-col"},G={key:0,class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},H=L({name:"FmMultiStepLoader",__name:"index",props:{loading:{type:Boolean,default:!1},steps:{},preventClose:{type:Boolean,default:!1}},emits:["stateChange","complete","close","error"],setup(r,{emit:c}){const u=r,l=c,e=w(0),m=w(!1),n=w({});async function i(s){if(typeof s.action=="function")try{const d=await s.action(n.value);return s.name&&(n.value[s.name]=d),!0}catch(d){return l("error",d,e.value),!1}return!0}async function k(){const s=u.steps[e.value];!s||!await i(s)||(e.value<u.steps.length-1?(e.value++,l("stateChange",e.value),x()):(m.value=!0,l("complete")))}async function x(){u.steps[e.value]&&await k()}function T(){l("close")}return B(()=>u.loading,s=>{s&&(e.value=0,m.value=!1,n.value={},x())}),(s,d)=>{const y=P;return o(),g($,{"enter-active-class":"transition-opacity duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-300","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:h(()=>[r.loading&&r.steps.length>0?(o(),f("div",R,[E(p("button",{class:"absolute right-4 top-4 z-5001 h-9 inline-flex items-center justify-center whitespace-nowrap rounded-md bg-primary px-3 text-sm text-primary-foreground font-medium ring-offset-background transition-colors disabled:pointer-events-none hover:bg-primary/90 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-ring",size:"sm",onClick:T},[v(y,{name:"i-heroicons:x-mark",class:"size-6"})],512),[[M,!r.preventClose]]),p("div",q,[p("div",X,[(o(!0),f(I,null,A(r.steps,(_,a)=>(o(),f("div",{key:a},[_?(o(),f("div",{key:0,class:"mb-4 flex items-center gap-2 text-left transition-all duration-300 ease-in-out",style:N({opacity:a===t(e)?1:Math.max(1-Math.abs(a-t(e))*.2,0),transform:"translateY(".concat(a===t(e)?-(t(e)*40):-(t(e)*40),"px)")})},[a<t(e)||a===r.steps.length-1&&a===t(e)&&t(m)?(o(),g(y,{key:0,name:"i-heroicons:check-circle-solid",class:"size-6 text-primary"})):a===t(e)&&(!t(m)||a!==r.steps.length-1)?(o(),g(y,{key:1,name:"i-heroicons:arrow-path",class:"size-6 animate-spin text-primary"})):(o(),g(y,{key:2,name:"i-heroicons:check-circle",class:"size-6 text-black opacity-50 dark:text-white"})),p("div",Y,[p("span",{class:V(["text-lg text-black dark:text-white",[a>t(e)&&"opacity-50"]])},C(_.text),3),v($,{"enter-active-class":"transition-all duration-300","enter-from-class":"opacity-0 -translate-y-1","enter-to-class":"opacity-100 translate-y-0"},{default:h(()=>[_.afterText&&(a<t(e)||a===r.steps.length-1&&a===t(e)&&t(m))?(o(),f("span",G,C(_.afterText),1)):b("",!0)]),_:2},1024)])],4)):b("",!0)]))),128))])]),d[0]||(d[0]=p("div",{class:"[mask-image:radial-gradient(900px_at_center,hsl(var(--primary))_30%,transparent)] absolute inset-x-0 bottom-0 z--1 h-full bg-white bg-gradient-to-t dark:bg-black"},null,-1))])):b("",!0)]),_:1})}}}),J={class:"flex gap-4"},K=L({__name:"_demo1",setup(r){const c=w(!1),u=[{text:"获取用户数据",afterText:"获取用户数据成功",name:"user",action:async()=>(await new Promise(n=>setTimeout(n,1e3)),{id:1,name:"张三"})},{text:"获取用户订单（随机模拟出错）",afterText:"获取用户订单成功",name:"orders",action:async n=>{if(await new Promise(i=>setTimeout(i,1500)),Math.random()>.5)throw new Error("获取订单数据失败：网络连接超时");return[{id:1,userId:n.user.id,product:"商品A"},{id:2,userId:n.user.id,product:"商品B"}]}},{text:"处理订单数据",action:async n=>(await new Promise(i=>setTimeout(i,2e3)),{user:n.user,orders:n.orders,totalAmount:n.orders.length*100})}];function l(n){S.info("当前步骤：".concat(n+1))}function e(){S.success("所有步骤已完成"),c.value=!1}function m(n,i){S.error("步骤 ".concat(i+1," 执行失败: ").concat(n.message)),c.value=!1}return(n,i)=>{const k=D,x=H;return o(),f("div",J,[v(k,{onClick:i[0]||(i[0]=T=>c.value=!t(c))},{default:h(()=>[j(C(t(c)?"停止":"开始"),1)]),_:1}),v(x,{loading:t(c),steps:u,"prevent-close":"",onStateChange:l,onComplete:e,onError:m},null,8,["loading"])])}}}),O="<script setup lang=\"ts\">\nimport type { Step, StepContext } from '@/ui/components/FmMultiStepLoader/index.vue'\nimport { toast } from 'vue-sonner'\n\nconst isLoading = ref(false)\nconst taskSteps: Step[] = [\n  {\n    text: '获取用户数据',\n    afterText: '获取用户数据成功',\n    name: 'user',\n    action: async () => {\n      // 模拟异步请求\n      await new Promise(resolve => setTimeout(resolve, 1000))\n      return { id: 1, name: '张三' }\n    },\n  },\n  {\n    text: '获取用户订单（随机模拟出错）',\n    afterText: '获取用户订单成功',\n    name: 'orders',\n    action: async (context: StepContext) => {\n      await new Promise(resolve => setTimeout(resolve, 1500))\n      // 随机模拟错误\n      if (Math.random() > 0.5) {\n        throw new Error('获取订单数据失败：网络连接超时')\n      }\n      return [\n        { id: 1, userId: context.user.id, product: '商品A' },\n        { id: 2, userId: context.user.id, product: '商品B' },\n      ]\n    },\n  },\n  {\n    text: '处理订单数据',\n    action: async (context: StepContext) => {\n      // 模拟异步请求\n      await new Promise(resolve => setTimeout(resolve, 2000))\n      return {\n        user: context.user,\n        orders: context.orders,\n        totalAmount: context.orders.length * 100,\n      }\n    },\n  },\n]\n\nfunction handleStateChange(state: number) {\n  toast.info(`当前步骤：${state + 1}`)\n}\n\nfunction handleComplete() {\n  toast.success('所有步骤已完成')\n  isLoading.value = false\n}\n\nfunction handleError(error: Error, stepIndex: number) {\n  toast.error(`步骤 ${stepIndex + 1} 执行失败: ${error.message}`)\n  isLoading.value = false\n}\n<\/script>\n\n<template>\n  <div class=\"flex gap-4\">\n    <FmButton @click=\"isLoading = !isLoading\">\n      {{ isLoading ? '停止' : '开始' }}\n    </FmButton>\n    <FmMultiStepLoader\n      :loading=\"isLoading\"\n      :steps=\"taskSteps\"\n      prevent-close\n      @state-change=\"handleStateChange\"\n      @complete=\"handleComplete\"\n      @error=\"handleError\"\n    />\n  </div>\n</template>\n",ee=L({__name:"index",setup(r){return(c,u)=>{const l=z,e=F;return o(),g(e,{navbar:"","navbar-start-side":"back"},{default:h(()=>[v(l,{code:t(O)},{default:h(()=>[v(K)]),_:1},8,["code"])]),_:1})}}});export{ee as default};
